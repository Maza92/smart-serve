<app-base-page>
  <ng-template #header>
    <div class="shadow">
      <app-back-bar title="Menú"></app-back-bar>
      <div class="w-full p-4">
        <div
          class="bg-on-surface p-1 rounded-xl flex gap-1 justify-center items-center h-12 relative"
        >
          <div
            class="absolute h-[calc(100%-8px)] rounded-xl bg-primary-key transition-all duration-300 ease-in-out"
            [ngStyle]="{
              width: 'calc(50% - 4px)',
              left: activeTab === 1 ? '4px' : 'calc(50% + 2px)'
            }"
          ></div>

          <button
            class="rounded-xl w-full h-full z-10"
            [ngClass]="{
              'font-semibold text-on-background': activeTab === 1,
              'font-regular text-background': activeTab !== 1
            }"
            (click)="activeTab = 1"
          >
            Menú
          </button>
          <button
            class="rounded-xl w-full h-full z-10"
            [ngClass]="{
              'font-semibold text-on-background': activeTab === 2,
              'font-regular text-background': activeTab !== 2
            }"
            (click)="activeTab = 2"
          >
            Orden
          </button>
        </div>
      </div>
    </div>
  </ng-template>

  <div slot="content" class="relative w-full">
    <div
      class="transition-all duration-300 ease-in-out absolute w-full"
      [ngClass]="{
        'opacity-100 z-10': activeTab === 1,
        'opacity-0 z-0': activeTab !== 1
      }"
    >
      <div class="p-4">
        <input
          type="text"
          class="form-input w-full px-2 py-3"
          placeholder="Buscar..."
        />
      </div>
      <div class="flex px-4 gap-2 pb-4 overflow-x-auto">
        <button class="button button-primary px-4 py-2 whitespace-nowrap">
          Todos
        </button>
        <button class="button button-outline px-4 py-2 whitespace-nowrap">
          Bebidas
        </button>
        <button class="button button-outline px-4 py-2 whitespace-nowrap">
          Comidas
        </button>
        <button class="button button-outline px-4 py-2 whitespace-nowrap">
          Postres
        </button>
      </div>

      <div class="m-4 space-y-4">
        <div
          class="border flex p-4 rounded-2xl gap-4 h-32 relative bg-outline border-gray-300"
          *ngFor="let dish of dishes"
        >
          <img
            class="w-26 h-auto object-cover rounded-xl shadow"
            [src]="dish.image"
            [alt]="dish.name"
          />
          <div class="flex flex-col gap-1 flex-grow">
            <h1 class="text-2xl font-bold">{{ dish.name }}</h1>
            <p class="text-sm text-gray-500">{{ dish.description }}</p>
            <p class="text-sm font-semibold">Precio: ${{ dish.price }}</p>
          </div>
          <button
            class="button button-primary absolute bottom-4 right-4"
            (click)="addToOrder(dish)"
          >
            <i-lucide name="plus" class="w-5 h-5"></i-lucide>
          </button>
        </div>
      </div>
    </div>

    <div
      class="transition-all duration-300 ease-in-out absolute w-full"
      [ngClass]="{
        'opacity-100 z-10': activeTab === 2,
        'opacity-0 z-0': activeTab !== 2
      }"
    >
      <div class="m-4 space-y-4" *ngIf="selectedDishes.length > 0">
        <div
          class="border flex p-4 rounded-2xl gap-4 h-32 relative bg-outline border-gray-300"
          *ngFor="let item of selectedDishes; let i = index"
        >
          <img
            class="w-26 h-auto object-cover rounded-xl shadow"
            [src]="item.dish.image"
            [alt]="item.dish.name"
          />
          <div class="flex flex-col gap-1 flex-grow">
            <h1 class="text-2xl font-bold">{{ item.dish.name }}</h1>
            <p class="text-sm text-gray-500">{{ item.dish.description }}</p>
            <p class="text-sm font-semibold">Precio: ${{ item.dish.price }}</p>
          </div>
          <div class="absolute bottom-4 right-4 flex items-center gap-2">
            <button
              class="button button-outline p-1 rounded-full"
              (click)="decreaseQuantity(i)"
            >
              <i-lucide name="minus" class="w-5 h-5"></i-lucide>
            </button>
            <span class="font-semibold">{{ item.quantity }}</span>
            <button
              class="button button-primary p-1 rounded-full"
              (click)="increaseQuantity(i)"
            >
              <i-lucide name="plus" class="w-5 h-5"></i-lucide>
            </button>
          </div>
        </div>
      </div>
      <div
        class="flex flex-col items-center justify-center h-64"
        *ngIf="selectedDishes.length === 0"
      >
        <i-lucide
          name="shopping-cart"
          class="w-16 h-16 text-gray-400"
        ></i-lucide>
        <p class="text-gray-500 mt-4">No hay platos seleccionados</p>
      </div>
    </div>
  </div>

  <div slot="footer" class="p-4 flex gap-4">
    <div class="flex flex-col w-min" *ngIf="selectedDishes.length > 0">
      <p class="font-semibold">{{ getTotalItems() }} platos</p>
      <p class="font-bold">Total: ${{ getTotalPrice() }}</p>
    </div>
    <button
      class="button button-action button-primary button-lg w-full"
      [disabled]="selectedDishes.length === 0"
      (click)="proceedToOrder()"
    >
      <span class="button-icon">
        <i-lucide name="check" class="w-5 h-5"></i-lucide>
      </span>
      <span class="button-label">Proceder con la orden</span>
    </button>
  </div>
</app-base-page>
